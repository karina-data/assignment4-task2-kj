---
title: "Bonanza Creek Hares Report"
subtitle: "Assignment 4 - Task 2"
author: "Karina Johnston"
date: "11/3/2021"
output: 
  html_document: 
    toc: yes
    theme: cerulean
---

```{r setup, include = FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# Attach packages
library(tidyverse) # graphs and visualizations and many functions
library(here) # standardized data referencing
library(equatiomatic) # output professional equations
library(lubridate) # to mutate the date format
library(kableExtra) # to create professional tables
library(broom) # functions for some analyses
library(effsize) # for Cohen's d effect size
```

## Introduction

Snowshoe hares, *Lepus americanus*, are a keystone prey species in northern boreal forests (Kielland et al. 2017); hare populations have been known to vary seasonally and in response to changing conditions such as food availability (Feierabend et al. 2014). Snowshoe hare population abundance and density in Alaska are studied by the Bonanza Creek Long Term Ecological Research (LTER) program, which is part of the US LTER Network (https://www.lter.uaf.edu/). In this report, the counts, sizes, and other characteristics of juvenile snowshoe hares recorded in a database from 1998 - 2012 will be explored. 

```{r, include = FALSE}
# read in the data from the .csv file
bonanza_hares <- read_csv(here("data", "bonanza_hares.csv"))
```

## Data and Analyses

Kielland et al. (2017) open source LTER data are used from a capture-recapture study conducted on snowshoe hares at five sites in the Tanana Valley, Alaska, USA. Specific relationships and visualizations that will be explored for juvenile hares include annual counts, juvenile weights (g) by sex and site location, and an exploratory analysis to look at the potential relationship between juvenile weights (g) and hind foot length (mm). 

Data are provided by the Bonanza Creek LTER, a partnership between the University of Alaska Fairbanks, and the U.S. Forest Service. Experimental design and data collection methods can be found in Flora (2002). Significant funding for collection of these data was provided by the National Science Foundation Long-Term Ecological Research program (NSF Grant numbers DEB-1636476, DEB-1026415, DEB-0620579, DEB-0423442, DEB-0080609, DEB-9810217, DEB-9211769, DEB-8702629) and by the USDA Forest Service, Pacific Northwest Research Station (Agreement # RJVA-PNW-01-JV-11261952-231).

Specific relationships and visualizations that will be explored for juvenile hares include annual counts, juvenile weights (g) by sex and site location, and an exploratory analysis to look at the potential relationship between juvenile weights (g) and hind foot length (mm). 
<br>

#### Annual juvenile hare trap counts

The total number of juvenile snowshoe hare trappings are counted for each year of the study (1998 - 2012) in Figure 1. 
<br>

```{r, fig.cap = "**Figure 1.** Juvenile Bonanza Creek hare counts by year (1998 - 2012). Data: Kielland et al. 2017.", fig.align = "center"}

# this code chunk mutates the data such that years will be cleanly organized 
bonanza_newdates <- bonanza_hares %>%  # creates a new dataframe beginning with bonanza_hares
  mutate(date_new = mdy(date)) %>%  # creates a new column using `lubridate::mdy()`
  mutate(year_new = year(date_new))  # creats a new year column

# this code chunk creates a new dataframe filtering for juveniles
bonanza_juveniles <- bonanza_newdates %>%
  filter(age == "j")

# this code chunk creates summary statistics
bonanza_stats <- bonanza_juveniles %>% # groups by year and counts the number by year
  group_by(year_new) %>% 
  summarize(count = n())

# this code chunk outputs a visualization bar graph for the counts by year data
bonanza_count <- ggplot(data = bonanza_stats, aes(x = year_new, y = count)) +
  geom_col(fill = "cyan4") + # so the bars are not grey
  theme_classic() + # for a cleaner graph with no gridlines
  labs(x = "Year", y = "Number of juvenile hares") + # to have formal axis labels 
  scale_x_continuous(breaks = 1999:2012) + # to clean up the x-axis year numbering
  scale_y_continuous(n.breaks = 11) # to increase the number of y-axis ticks
  
bonanza_count

# this code chunk outputs summary statistics for in-line use
max_count <- max(bonanza_stats$count) # to find the maximum count value
min_count <- min(bonanza_stats$count) # to find the minimum count value
mean_count <- mean(bonanza_stats$count) # to find the mean count across years
sd_count <- sd(bonanza_stats$count) # to find the standard deviation across years
median_count <- median(bonanza_stats$count) # to find the median count
```

Counts of trapped juvenile hares over time were positively skewed, but varied by year with a range of `r min_count` to `r max_count` (min to max). Total trapping counts were generally found to decrease over time, although the data were variable by year. Summary statistics for the annual count totals were also calculated including median annual hare count (`r median_count`) and mean annual hare count (`r round(mean_count, 2)` $\pm$ `r round(sd_count, 2)`) (mean $\pm$ standard deviation). Since the data are heavily weighted by the highest counts in earlier years, the median value may be a more representative measure of central tendency.

The data are presented as absolute counts; therefore, to standardize the results and provide a more representative trend in a future analysis, the counts could be weighted by unit effort. For example, data couple be presented as count/number of traps per unit area.
<br>

#### Visualize juvenile hare weights

```{r}
# this code chunk sets up changes in the bonanza_juvenile dataframe column "sex" that are needed later for data visualization

bonanza_juveniles["sex"][bonanza_juveniles["sex"] == "m"] <- "Male" # change "m" to "Male"
bonanza_juveniles["sex"][bonanza_juveniles["sex"] == "f"] <- "Female" # change "f" to "Female"
```

(both raw data (Figure 2) and summary statistics (Figure 3))

```{r, fig.cap = "**Figure 2.** Raw weight (g) data for Bonanza Creek juvenile snowshoe hares grouped by site and sex.", fig.align = "center"}

# new facet label names for site ("grid") variable
site.labs <- c("Black Spruce", "Bonanza Mature", "Bonanza Riparian")
names(site.labs) <- c("bonbs", "bonmat", "bonrip")

# create a jitterplot using bonanza_juveniles dataframe
ggplot(data = bonanza_juveniles, aes(x = sex, y = weight, color = sex)) +
  geom_jitter(aes(alpha = 0.9), # change the size and transparency of the points
              size = 3) +  
  facet_grid(~ grid,
             labeller = labeller(grid = site.labs)) + # change label names

  labs(x = "Sex", y = "Weight (g)") +
  theme_bw() + # cleans up the aesthetics of the overall theme
  theme(plot.title = element_text(hjust = 0.5), # centered title
        panel.grid = element_blank()) + # removes gridlines
  
  guides(color = "none", alpha = "none") # removes unnecessary legends
```


```{r, fig.cap = "**Figure 3.** Summary weight (g) data for Bonanza Creek juvenile snowshoe hares grouped by site and sex.", fig.align = "center"}

# create a boxplot using bonanza_juveniles dataframe
ggplot(data = bonanza_juveniles, aes(x = sex, y = weight, fill = sex)) +
  geom_boxplot() +

# facets by site (grid) and relabels sites and x-axis
  facet_grid(~ grid,
             labeller = labeller(grid = site.labs)) +
  theme_bw() + # cleaner graph aesthetics
  theme(plot.title = element_text(hjust = 0.5), # centered title
        panel.grid = element_blank()) + # removes gridlines
  labs(x = "Sex", y = "Weight (g)") + # cleans up axes labels
  
  guides(fill = "none") # removes unnecessary legend
```

INSERT MAIN TAKEAWAY TEXT.


#### Juvenile weight comparison 

```{r, include = FALSE}

# exploratory histogram
ggplot(data = bonanza_juveniles, aes(x = weight)) +
  geom_histogram(bins = 12) +
  facet_wrap(~ sex) +
  theme_classic()

# exploratory q-q plot
ggplot(data = bonanza_juveniles, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~ sex) +
  theme_classic()
```


```{r}
# these functions group by sex and produce the summary statistics (rounded)
hare_weight_stats <- bonanza_juveniles %>% 
  group_by(sex) %>% 
  summarize(mean_weight = round(mean(weight, na.rm = TRUE), 2),
            sd_weight = round(sd(weight, na.rm = TRUE), 2),
            sample_size = n())

# these functions update the table to be cleaner, easier to read, and visually appealing
kable(hare_weight_stats,
      col.names = c("Sex", # changes the column names
                    "Mean Weight (g)", 
                    "Standard Deviation (g)",
                    "Sample Size"),
      align = "lccc", # changes the alignment of the columns
    
# adds a caption
      caption = "Table 1. Summary statistics for juvenile male and female snowshoe hare weights (g) at Bonanza Creek 1998-2012 (Johnston).") %>% 

# better lines within the table
kable_classic(full_width = F)
```

```{r}
bonanza_juveniles %>% 
  count(sex)
```



t-test and effect size

```{r, include = FALSE}
weight_male <- bonanza_juveniles %>% # creates a new dataframe for male weights
  filter(sex == "Male") %>% # to filter male weights
  drop_na(weight) %>% # to drop the NAs
  pull(weight) # to pull a vector of just weights (easier for t-test)

weight_female <- bonanza_juveniles %>%# creates a new dataframe for female weights
  filter(sex =="Female") %>% # to filter female weights
  drop_na(weight) %>% # to drop NAs
  pull(weight) # to pull a vector of just weights (easier for t-test)

# execute the t-test
weight_ttest <- t.test(weight_male, weight_female)
weight_ttest # output t-test results

# execute the cohen d test (for effect size)
weight_cohen_d <- cohen.d(weight_male, weight_female)
weight_cohen_d # output the cohen d results
```

Since there was a large sample size which can disproportionately affect the statistical significance of the p-value, Cohen's *d* was also used to assess effect size (Cohen's *d* = `r round(weight_cohen_d$estimate, 2)`). Since the effect size was small, it is unlikely that a practical difference exists between the male and female weights. 

#### Relationship between juvenile weight and hind foot length

```{r, fig.cap = "Figure 4. INSERT !!!!!!!!!!!"}

# create a scatterplot of hindfoot length to weight of juvenile hares (all)
ggplot(data = bonanza_juveniles, aes(x = hindft, 
                                     y = weight)) + 
  geom_point(aes(alpha = 0.9), # changes transparency and size
             size = 3,
             color = 4) + # changes color to blue
  theme_classic() + # cleaner graph output
  labs(x = "Hind foot length (mm)", y = "Weight (g)") +
  guides(color = FALSE, size = FALSE, alpha = FALSE) # removes unnecessary legends

```

```{r}
# correlation test
hare_cor <- cor.test(bonanza_juveniles$weight, bonanza_juveniles$hindft)
hare_cor
```


```{r, include = FALSE}
# linear model, stored as hare_lm
hare_lm <- lm(weight ~ hindft, data = bonanza_juveniles)

#output results of the linear model
summary(hare_lm)
```


```{r, include = FALSE}
# show the visualizations to consider the model assumptions
plot(hare_lm)
```

moderate correlation (Pearson's correlation: *r* = `r round(hare_cor$estimate, 2)`), t(`r hare_cor$parameter`) = `r round(hare_cor$statistic, 2)`.



## Summary of Findings



## Citations

Feierabend, Dashiell, Knut Kielland, Movements, activity patterns, and habitat use of snowshoe hares (Lepus americanus) in interior Alaska, Journal of Mammalogy, Volume 95, Issue 3, 26 June 2014, Pages 525–533, https://doi.org/10.1644/13-MAMM-A-199

Flora, B.K. 2002. Comparison of snowshoe hare populations in Interior Alaska. M.S. Thesis. University of Alaska-Fairbanks.

Grolemund, Garrett, and Hadley Wickham (2011). Dates and Times Made Easy with lubridate. Journal of Statistical Software, 40(3), 1-25. URL https://www.jstatsoft.org/v40/i03/.

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

Müller, Kirill (2020). here: A Simpler Way to Find Your Files. R package version 1.0.1. https://CRAN.R-project.org/package=here

R Core Team (2021). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.

Torchiano M (2020). effsize: Efficient Effect Size Computation. doi: 10.5281/zenodo.1480624 (URL:
https://doi.org/10.5281/zenodo.1480624), R package version 0.8.1, <URL:
https://CRAN.R-project.org/package=effsize>.

Wickham et al., (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43), 1686, https://doi.org/10.21105/joss.01686

Zhu, Hao (2021). kableExtra: Construct Complex Table with 'kable' and Pipe Syntax. R package version 1.3.4. https://CRAN.R-project.org/package=kableExtra
