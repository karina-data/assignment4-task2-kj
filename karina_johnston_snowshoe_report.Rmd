---
title: "Bonanza Creek Hares Report"
subtitle: "Assignment 4 - Task 2"
author: "Karina Johnston"
date: "11/3/2021"
output: 
  html_document: 
    toc: yes
    theme: cerulean
---

```{r setup, include = FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# Attach packages
library(tidyverse)
library(here)
library(equatiomatic)
library(lubridate)
library(kableExtra)
library(broom)
```

## Introduction

Bonanza Creek Long Term Ecological Research (LTER) program is part of the US LTER Network. In this report, the counts and sizes of juvenile snowshoe hares recorded from 1998 - 2012 will be explored. Snowshoe hares, *Lepus americanus*, are a 'keystone' prey species in northern boreal forests (Kielland et al. 2017). **INSERT SENTENCES ABOUT WHAT IS IN THIS REPORT.** 

Data are provided by the Bonanza Creek LTER, a partnership between the University of Alaska Fairbanks, and the U.S. Forest Service. Significant funding for collection of these data was provided by the National Science Foundation Long-Term Ecological Research program (NSF Grant numbers DEB-1636476, DEB-1026415, DEB-0620579, DEB-0423442, DEB-0080609, DEB-9810217, DEB-9211769, DEB-8702629) and by the USDA Forest Service, Pacific Northwest Research Station (Agreement # RJVA-PNW-01-JV-11261952-231).


```{r}
# read in the data from the .csv file
bonanza_hares <- read_csv(here("data", "bonanza_hares.csv"))
```


## Data and Analyses

Capture-recapture studies were conducted on snowshoe hares at five sites in the Tanana Valley. 


### Juvenile hare initial investigation

#### Annual juvenile hare trap counts


```{r, fig.cap = "**Figure 1.** Juvenile Bonanza Creek hare counts by year (1998 - 2012). Data: Kielland et al. 2017.", fig.align = "center"}

bonanza_newdates <- bonanza_hares %>%  # creates a new dataframe beginning with bonanza_hares
  mutate(date_new = mdy(date)) %>%  # creates a new column using `lubridate::mdy()`
  mutate(year_new = year(date_new))  # creats a new year column

bonanza_juveniles <- bonanza_newdates %>% # creates a new dataframe filtering for juveniles
  filter(age == "j")

bonanza_stats <- bonanza_juveniles %>% # groups by year and counts the number by year
  group_by(year_new) %>% 
  summarize(count = n())

# this code chunk outputs a visualization bar graph for the counts by year data
bonanza_count <- ggplot(data = bonanza_stats, aes(x = year_new, y = count)) +
  geom_col(fill = "cyan4") + # so the bars are not grey
  theme_classic() + # for a cleaner graph with no gridlines
  labs(x = "Year", y = "Number of juvenile hares") + # to have formal axis labels 
  scale_x_continuous(breaks = 1999:2012) # to clean up the x-axis labels

bonanza_count

# this code chunk outputs summary statistics for in-line use
max_count <- max(bonanza_stats$count) # to find the maximum count value
min_count <- min(bonanza_stats$count) # to find the minimum count value
mean_count <- mean(bonanza_stats$count) # to find the mean count across years
sd_count <- sd(bonanza_stats$count) # to find the standard deviation across years
median_count <- median(bonanza_stats$count) # to find the median count
```

Distribution of juvenile hare counts was positively skewed. 

maximum count (`r max_count`), minimum count (`r min_count`), mean count (`r round(mean_count, 2)` $\pm$ `r round(sd_count, 2)`), median count (`r median_count`)


Mean annual number of juvenile hares trapped was XXX $\pm$ XXXX (mean $\pm$ SD)


#### Visualize juvenile hare weights

```{r, fig.cap = "Figure 2. INSERT!!!!!"}

# new facet label names for site ("grid") variable
site.labs <- c("Black Spruce", "Bonanza Mature", "Bonanza Riparian")
names(site.labs) <- c("bonbs", "bonmat", "bonrip")

# new label names for sex (x-variable)
sex.labs <- c("Female", "Male", "N/A")
names(sex.labs) <- c("f", "m", "NA")

# create a jitterplot using bonanza_juveniles dataframe
ggplot(data = bonanza_juveniles, aes(x = sex, y = weight, color = sex)) +
  geom_jitter(aes(alpha = 0.9), 
              size = 2.5) +  # change the size and transparency of the points
  facet_grid(~ grid,
             labeller = labeller(grid = site.labs, 
                                 sex = sex.labs)) + # change label names

  labs(x = "Sex", y = "Weight (g)") +
  theme_bw() + # cleans up the aesthetics of the overall theme
  theme(plot.title = element_text(hjust = 0.5), # centered title
        panel.grid = element_blank()) + # removes gridlines
  
  guides(color = "none", alpha = "none") # removes unnecessary legends
```

```{r, fig.cap = "Figure 3. INSERT!!!!!!!"}

# create a boxplot using bonanza_juveniles dataframe
ggplot(data = bonanza_juveniles, aes(x = sex, y = weight, fill = sex)) +
  geom_boxplot() +

# facets by site (grid) and relabels sites and x-axis
  facet_grid(~ grid,
             labeller = labeller(grid = site.labs)) +
  theme_bw() + # cleaner graph aesthetics
  theme(plot.title = element_text(hjust = 0.5), # centered title
        panel.grid = element_blank()) + # removes gridlines
  labs(x = "Sex", y = "Weight (g)") + # cleans up axes labels
  
  guides(fill = "none") # removes unnecessary legend
```

INSERT MAIN TAKEAWAY TEXT. (both raw data (Figure 2) and summary statistics (Figure 3))


#### Juvenile weight comparison 

```{r, include = FALSE}

# exploratory histogram
ggplot(data = bonanza_juveniles, aes(x = weight)) +
  geom_histogram(bins = 12) +
  facet_wrap(~ sex) +
  theme_classic()

# exploratory q-q plot
ggplot(data = bonanza_juveniles, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~ sex) +
  theme_classic()
```


```{r}
# these functions group by sex and produce the summary statistics (rounded)
hare_weight_stats <- bonanza_juveniles %>% 
  group_by(sex) %>% 
  summarize(mean_weight = round(mean(weight), 2),
            sd_weight = round(sd(weight), 2),
            sample_size = n())

# these functions update the table to be cleaner, easier to read, and visually appealing
kable(hare_weight_stats,
      col.names = c("Sex", # changes the column names
                    "Mean Weight (g)", 
                    "Standard Deviation (g)",
                    "Sample Size"),
      align = "lccc", # changes the alignment of the columns
    
# adds a caption
      caption = "Table 1. Summary statistics for juvenile male and female snowshoe hare weights (g) at Bonanza Creek 1998-2012 (Johnston).") %>% 

# better lines within the table
kable_classic(full_width = F)
```


t-test and effect size

```{r}
weight_male <- bonanza_juveniles %>% # creates a new dataframe for male weights
  filter(sex == "m") %>% # to filter male weights
  drop_na(weight) %>% # to drop the NAs
  pull(weight) # to pull a vector of just weights (easier for t-test)
  
weight_female <- bonanza_juveniles %>%# creates a new dataframe for female weights
  filter(sex =="f") %>% # to filter female weights
  drop_na(weight) %>% # to drop NAs
  pull(weight) # to pull a vector of just weights (easier for t-test)

# execute the t-test
weight_ttest <- t.test(weight_male, weight_female)
weight_ttest # output t-test results

# execute the cohen d test (for effect size)
weight_cohen_d <- cohen.d(weight_male, weight_female)
weight_cohen_d # output the cohen d results
```

Effect size was small (Cohen's *d* = `r round(weight_cohen_d$estimate, 2)`)

#### Relationship between juvenile weight and hind foot length

```{r, fig.cap = "Figure 4. INSERT !!!!!!!!!!!"}

# create a scatterplot of hindfoot length to weight of juvenile hares (all)
ggplot(data = bonanza_juveniles, aes(x = hindft, 
                                     y = weight)) + 
  geom_point(aes(alpha = 0.9), # changes transparency and size
             size = 3,
             color = 4) + # changes color to blue
  theme_classic() + # cleaner graph output
  labs(x = "Hind foot length (mm)", y = "Weight (g)") +
  guides(color = FALSE, size = FALSE, alpha = FALSE) # removes unnecessary legend

```

```{r}
# correlation test
hare_cor <- cor.test(bonanza_juveniles$weight, bonanza_juveniles$hindft)
hare_cor
```


```{r, include = FALSE}
# linear model, stored as hare_lm
hare_lm <- lm(weight ~ hindft, data = bonanza_juveniles)

#output results of the linear model
summary(hare_lm)

# show the visualizations to consider the model assumptions
plot(hare_lm)
```

moderate correlation (Pearson's correlation: *r* = `r round(hare_cor$estimate, 2)`), t(`r hare_cor$parameter`) = `r round(hare_cor$statistic, 2)`.



## Summary of Findings



## Citations

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14


